MODULE LOAD_ACRANEB2_MOD

USE PARKIND1, ONLY : JPIM, JPRB, JPRD

IMPLICIT NONE

CONTAINS

SUBROUTINE LOAD_ACRANEB2(CDNAME, &
! - INPUT
 & YDERDI,YDRIP,YDML_PHY_MF,KIDIA,KFDIA,KLON,KTDIA,KLEV,KJN,KSTEP, &
! - INPUT 2D
 & PAPRS,PAPRSF,PCP,PR,PDELP,PNEB,PQ,PQCO2,PQICE,PQLI,PQO3,PT, &
! - INPUT 1D
 & PALB,PALBDIR,PEMIS,PGELAM,PGEMU,PMU0,PMU0LU,PTS,PDECRD,PCLCT, &
! - INPUT/OUTPUT
 & PGDEOSI,PGUEOSI,PGMU0,PGMU0_MIN,PGMU0_MAX, &
 & PGDEOTI,PGDEOTI2,PGUEOTI,PGUEOTI2,PGEOLT,PGEOXT, &
 & PGRPROX,PGMIXP,PGFLUXC,PGRSURF,PSDUR, &
! - OUTPUT 2D
 & PFRSO,PFRTH, &
! - OUTPUT 1D
 & PFRSODS,PFRSOPS,PFRSOLU,PFRTHDS, &
! - INPUT 2D x 6
 & PDAER)

USE MODEL_PHYSICS_MF_MOD , ONLY : MODEL_PHYSICS_MF_TYPE
USE PARKIND1 ,ONLY : JPIM     ,JPRB
USE YOMCST   ,ONLY : RSIGMA   ,RG       ,RPI      ,RDAY

USE YOMRIP   ,ONLY : TRIP
USE YOERDI   ,ONLY : TERDI

USE LOAD_YOMCST_MOD
USE LOAD_YOMLOUIS_MOD
USE LOAD_YOMPHY0_MOD
USE LOAD_YOMPHY1_MOD
USE LOAD_YOMPHY2_MOD
USE LOAD_YOMPHY_MOD
USE LOAD_TERDI_MOD
USE LOAD_MODEL_PHYSICS_MF_TYPE_MOD
USE LOAD_TRIP_MOD
USE LOAD_MOD

IMPLICIT NONE

! new argument: filename
CHARACTER(LEN=*), INTENT(IN) :: CDNAME

! original arguments
TYPE(TERDI)        :: YDERDI
TYPE(MODEL_PHYSICS_MF_TYPE):: YDML_PHY_MF
TYPE(TRIP)        :: YDRIP
INTEGER(KIND=JPIM) :: KIDIA 
INTEGER(KIND=JPIM) :: KFDIA 
INTEGER(KIND=JPIM) :: KLON 
INTEGER(KIND=JPIM) :: KTDIA 
INTEGER(KIND=JPIM) :: KLEV 
INTEGER(KIND=JPIM) :: KJN
INTEGER(KIND=JPIM) :: KSTEP

REAL(KIND=JPRB), POINTER    :: PAPRS(:,:) 
REAL(KIND=JPRB), POINTER    :: PAPRSF(:,:)
REAL(KIND=JPRB), POINTER    :: PCP(:,:)
REAL(KIND=JPRB), POINTER    :: PR(:,:)
REAL(KIND=JPRB), POINTER    :: PDELP(:,:)
REAL(KIND=JPRB), POINTER    :: PNEB(:,:)
REAL(KIND=JPRB), POINTER    :: PQ(:,:)
REAL(KIND=JPRB), POINTER    :: PQCO2(:,:)
REAL(KIND=JPRB), POINTER    :: PQICE(:,:)
REAL(KIND=JPRB), POINTER    :: PQLI(:,:)
REAL(KIND=JPRB), POINTER    :: PQO3(:,:) 
REAL(KIND=JPRB), POINTER    :: PT(:,:)
REAL(KIND=JPRB), POINTER    :: PALB(:)
REAL(KIND=JPRB), POINTER    :: PALBDIR(:)
REAL(KIND=JPRB), POINTER    :: PEMIS(:)
REAL(KIND=JPRB), POINTER    :: PGELAM(:)
REAL(KIND=JPRB), POINTER    :: PGEMU(:)
REAL(KIND=JPRB), POINTER    :: PMU0(:)
REAL(KIND=JPRB), POINTER    :: PMU0LU(:)
REAL(KIND=JPRB), POINTER    :: PTS(:)
REAL(KIND=JPRB), POINTER    :: PDECRD(:)
REAL(KIND=JPRB), POINTER    :: PCLCT(:)
REAL(KIND=JPRB), POINTER :: PGDEOSI(:,:,:)
REAL(KIND=JPRB), POINTER :: PGUEOSI(:,:,:)
REAL(KIND=JPRB), POINTER :: PGMU0(:,:)
REAL(KIND=JPRB), POINTER :: PGMU0_MIN(:)
REAL(KIND=JPRB), POINTER :: PGMU0_MAX(:)
REAL(KIND=JPRB), POINTER :: PGDEOTI(:,:)
REAL(KIND=JPRB), POINTER :: PGDEOTI2(:,:)
REAL(KIND=JPRB), POINTER :: PGUEOTI(:,:)
REAL(KIND=JPRB), POINTER :: PGUEOTI2(:,:)
REAL(KIND=JPRB), POINTER :: PGEOLT(:,:)
REAL(KIND=JPRB), POINTER :: PGEOXT(:,:)
REAL(KIND=JPRB), POINTER :: PGRPROX(:,:)
REAL(KIND=JPRB), POINTER :: PGMIXP(:,:)
REAL(KIND=JPRB), POINTER :: PGFLUXC(:,:)
REAL(KIND=JPRB), POINTER :: PGRSURF(:)
REAL(KIND=JPRB), POINTER :: PSDUR(:)
REAL(KIND=JPRB), POINTER   :: PFRSO(:,:) 
REAL(KIND=JPRB), POINTER   :: PFRTH(:,:) 
REAL(KIND=JPRB), POINTER   :: PFRSODS(:)
REAL(KIND=JPRB), POINTER   :: PFRSOPS(:)
REAL(KIND=JPRB), POINTER   :: PFRSOLU(:)
REAL(KIND=JPRB), POINTER   :: PFRTHDS(:)
REAL(KIND=JPRB), POINTER    :: PDAER(:,:,:) 

! local variables
INTEGER :: FID=77
INTEGER(KIND=JPIM ) :: IMAGIC=12345
REAL(KIND=JPRD) :: ZMAGIC=12345.

! open output file
OPEN (UNIT=FID,  FILE=TRIM(CDNAME),  FORM='UNFORMATTED', ACCESS='STREAM')

! read magic number for checking
READ(FID) IMAGIC
READ(FID) ZMAGIC

IF ( IMAGIC /= 12345 .OR. ZMAGIC/=12345. ) THEN
  WRITE (0,*) "Something went wrong in reading; probably inconsistency with writing (endianness, precision)"
  CALL ABORT
ENDIF

! write module variables
CALL LOAD_YOMCST (FID)
CALL LOAD_YOMLOUIS (FID)
CALL LOAD_YOMPHY0 (FID)
CALL LOAD_YOMPHY1 (FID)
CALL LOAD_YOMPHY2 (FID)
CALL LOAD_YOMPHY (FID)

! write arguments
CALL LOAD( FID ,YDERDI )
CALL LOAD( FID ,YDML_PHY_MF )
CALL LOAD( FID ,YDRIP )
CALL LOAD( FID ,KIDIA  )
CALL LOAD( FID ,KFDIA  )
CALL LOAD( FID ,KLON  )
CALL LOAD( FID ,KTDIA  )
CALL LOAD( FID ,KLEV  )
CALL LOAD( FID ,KJN )
CALL LOAD( FID ,KSTEP )
CALL LOAD( FID ,PAPRS )
CALL LOAD( FID ,PAPRSF )
CALL LOAD( FID ,PCP )
CALL LOAD( FID ,PR )
CALL LOAD( FID ,PDELP )
CALL LOAD( FID ,PNEB )
CALL LOAD( FID ,PQ )
CALL LOAD( FID ,PQCO2 )
CALL LOAD( FID ,PQICE )
CALL LOAD( FID ,PQLI )
CALL LOAD( FID ,PQO3 )
CALL LOAD( FID ,PT )
CALL LOAD( FID ,PALB )
CALL LOAD( FID ,PALBDIR )
CALL LOAD( FID ,PEMIS )
CALL LOAD( FID ,PGELAM )
CALL LOAD( FID ,PGEMU )
CALL LOAD( FID ,PMU0 )
CALL LOAD( FID ,PMU0LU )
CALL LOAD( FID ,PTS )
CALL LOAD( FID ,PDECRD )
CALL LOAD( FID ,PCLCT )
CALL LOAD( FID ,PGDEOSI )
CALL LOAD( FID ,PGUEOSI )
CALL LOAD( FID ,PGMU0 )
CALL LOAD( FID ,PGMU0_MIN )
CALL LOAD( FID ,PGMU0_MAX )
CALL LOAD( FID ,PGDEOTI )
CALL LOAD( FID ,PGDEOTI2 )
CALL LOAD( FID ,PGUEOTI )
CALL LOAD( FID ,PGUEOTI2 )
CALL LOAD( FID ,PGEOLT )
CALL LOAD( FID ,PGEOXT )
CALL LOAD( FID ,PGRPROX )
CALL LOAD( FID ,PGMIXP )
CALL LOAD( FID ,PGFLUXC )
CALL LOAD( FID ,PGRSURF )
CALL LOAD( FID ,PSDUR )
CALL LOAD( FID ,PFRSO )
CALL LOAD( FID ,PFRTH )
CALL LOAD( FID ,PFRSODS )
CALL LOAD( FID ,PFRSOPS )
CALL LOAD( FID ,PFRSOLU )
CALL LOAD( FID ,PFRTHDS )
CALL LOAD( FID ,PDAER )

! read magic number for checking
READ(FID) IMAGIC
READ(FID) ZMAGIC

IF ( IMAGIC /= 12345 .OR. ZMAGIC/=12345. ) THEN
  WRITE (0,*) "Something went wrong in reading; probably inconsistency with writing (endianness, precision)"
  CALL ABORT
ENDIF

! close file
CLOSE(UNIT=FID)

END SUBROUTINE LOAD_ACRANEB2

END MODULE LOAD_ACRANEB2_MOD
